---
title: "tidytuesday_2019_week17"
author: "Youngseok Hahm"
date: "12/16/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Call library
```{r}
library(tidyverse)
library(gganimate)
library(plotly)
```


# Get the Data
```{r}
dog_moves <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-12-17/dog_moves.csv')
dog_travel <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-12-17/dog_travel.csv')
dog_descriptions <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-12-17/dog_descriptions.csv')
```

# Data Cleaning
```{r}
# 33 observations with wrong data entry
# data from column 26 ('photo') should be moved to right by one
temp = dog_descriptions %>% filter(status != 'adoptable')
head(temp[,25:28])

temp[, 27:34] = temp[, 26:33]
temp[,26] = NA
head(temp[,25:28])

# Update the original dataset
dog_descriptions[match( temp$url, dog_descriptions$url ), ] <- temp
```

```{r}
dog_descriptions %>% 
  group_by(contact_state) %>%
  summarize(total = n()) %>%
  top_n(20, total) %>%
  select(contact_state) -> top_20_states

# Top 20 states with most adoptable dogs available by sex
dog_descriptions %>%
  filter(contact_state %in% top_20_states$contact_state ) %>%
  group_by(contact_state, sex) %>%
  summarize(count = n()) %>%
  plot_ly(x = ~contact_state, y = ~count, type = "bar", color = ~sex)
    
# Top 20 states with most adoptable dogs available by age
dog_descriptions %>%
  filter(contact_state %in% top_20_states$contact_state ) %>%
  group_by(contact_state, age) %>%
  summarize(count = n()) %>%
  plot_ly(x = ~contact_state, y = ~count, type = "bar", color = ~age)
```


```{r}

scale_graph = function(x) {
  (x - min(x))/(max(x)-min(x))
}

dog_descriptions %>%
  mutate( posted_date = str_extract(posted, "([^T]+)") ) %>%
  select(posted_date) %>%
  group_by(posted_date) %>%
  summarize(count = n()) %>%
  mutate( year = strsplit(posted_date, '-') %>% map_chr(., 1),
          month = strsplit(posted_date, '-') %>% map_chr(., 2),
          count = scale_graph(count)) %>%
  filter( year == '2019' ) %>%
  ggplot(aes(x = posted_date, y = count, fill=month )) + 
    geom_bar(stat="identity", alpha = 0.5) +
    ylim(-1,1) +
    theme_minimal() +
    theme(
      axis.text = element_blank(),
      axis.title = element_blank(),
      panel.grid = element_blank(),
      plot.margin = unit(rep(-1,4), "cm") 
    ) +
    coord_polar(start = 0)
  
```
